checks for report_category_sales:
  - attributes:
      pipeline_stage: Report
      pipeline: soda_demo_data_pipeline
      data_domain: Transaction
      team: Sales Operations

  - row_count > 0:
      name: Report table cannot be empty
      attributes:
        dimension: [Completeness]

  
  - missing_count(category_key) = 0:
      name: No undefined product categories
      attributes:
        dimension: [Completeness]

  - uncategorized_sales_percent < 0.9:
      uncategorized_sales_percent query: >
        select ROUND(CAST((sales_total * 100) / (select sum(sales_total) from report_category_sales) AS numeric), 2) as uncategorized_sales_percent from report_category_sales where category_key is NULL
      name: Most sales are categorized
      attributes:
        dimension: [Accuracy]

        
  - sales_diff = 0:
      name: Category sales total matches
      sales_diff query: >
        SELECT CAST((SELECT SUM(fact_internet_sales.sales_amount) FROM fact_internet_sales)
        - (SELECT SUM(report_category_sales.sales_total) FROM report_category_sales) as numeric) AS sales_diff
      attributes:
        dimension: [Accuracy]
